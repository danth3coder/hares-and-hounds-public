(this["webpackJsonphares-and-hounds-react"]=this["webpackJsonphares-and-hounds-react"]||[]).push([[0],{25:function(t,e,a){},30:function(t,e,a){},31:function(t,e){function a(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}a.keys=function(){return[]},a.resolve=a,t.exports=a,a.id=31},38:function(t,e,a){"use strict";a.r(e);a(25);var n=a(0),s=a.n(n),i=a(21),c=a.n(i),o=a(2),r=a(12),d=a(13),h=a(7),l=a(15),p=a(14),_=(a(30),a(22)),u=a.n(_),m=a(10),b=a(1),j="hound",g="hare",O="empty",y="update_game",f="reset_game";function v(t){var e=t.x_pos,a=t.y_pos,n=t.type,s=t.highlighted,i=t.onClick,c=t.playable,o={left:139*(e-1)+23,top:120*(a-1)+27},r="node ".concat(n||"".concat(a,",").concat(e)," ").concat(s?"highlighted":""," ").concat(c?"playable":"");return Object(b.jsx)("div",{className:r,style:o,onClick:function(){return i(a,e)}})}var x=function(t){Object(l.a)(a,t);var e=Object(p.a)(a);function a(t){var n;return Object(r.a)(this,a),(n=e.call(this,t)).game_data=n.props.game_data,n.game_type=n.game_data.type,n.hare_location="",n.hound_location=new Set,n.conn=n.props.conn,n.default_selected_node={y_pos:0,x_pos:0,type:O},n.default_matrix={1:{2:{},3:{},4:{}},2:{1:{},2:{},3:{},4:{},5:{}},3:{2:{},3:{},4:{}}},n.default_state={matrix:n.default_matrix,selected_node:n.default_selected_node,current_turn:j,turn_number:1,game_in_progress:!1,winning_side:""},n.state=Object(o.a)(Object(o.a)({},n.default_state),{},{player_side:""}),n.default_state=n.state,n.setGameMatrix(),n.selectNode=n.selectNode.bind(Object(h.a)(n)),n.resetGame=n.resetGame.bind(Object(h.a)(n)),n.endGame=n.endGame.bind(Object(h.a)(n)),n.handleReset=n.handleReset.bind(Object(h.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var t=this;if(this.game_type===w){if(null===this.conn)return console.log("no connection"),void this.EndGameSessionCallback();this.setState({player_side:this.game_data.online_data.is_host?j:g}),this.conn.on("data",(function(e){switch(e.type){case y:var a=e.old_position.split(","),n=Object(m.a)(a,2),s=n[0],i=n[1],c=e.new_position.split(","),o=Object(m.a)(c,2),r=o[0],d=o[1];t.updateNodePosition(s,i,r,d),t.updateGameRound();break;case f:t.resetGame()}})),this.conn.on("error",(function(e){console.log(e),t.props.EndGameSessionCallback()})),this.conn.on("close",(function(){t.props.EndGameSessionCallback()}))}this.setState({game_in_progress:!0})}},{key:"componentWillUnmount",value:function(){}},{key:"setGameMatrix",value:function(){var t=this,e=this.state.matrix;for(var a in e)for(var n in e[a]){a=parseInt(a),n=parseInt(n),e[a][n].type=O,e[a][n].paths=[new Set,new Set];for(var s=-1;s<=1;s++)for(var i=-1;i<=1;i++){var c=a+s,o=n+i;if(n%2===0&&a%2===0||a%2!==0&&n%2!==0)if(!new Set(["-1,0","1,0","0,-1","0,1"]).has("".concat(s,",").concat(i)))continue;if(c in e&&o in e[c]&&(o!==n||c!==a)){var r="".concat(c,",").concat(o);o<n?e[a][n].paths[1].add(r):e[a][n].paths[0].add(r)}}}e[1][2].type=j,e[2][1].type=j,e[3][2].type=j,["1,2","2,1","3,2"].forEach((function(e){return t.hound_location.add(e)})),e[2][5].type=g,this.hare_location="2,5",this.setState({matrix:e})}},{key:"updateNodePosition",value:function(t,e,a,n){var s=this.state.matrix,i=s[t][e].type;s[t][e].type=O,s[a][n].type=i,i===j?(this.hound_location.delete("".concat(t,",").concat(e)),this.hound_location.add("".concat(a,",").concat(n))):this.hare_location="".concat(a,",").concat(n),this.setState({matrix:s})}},{key:"selectNode",value:function(t,e){if((this.game_type!==w||this.state.current_turn===this.state.player_side)&&this.state.game_in_progress){var a=this.state.matrix[t][e];if(this.state.selected_node.type!==O&&a.type===O){var n=!1;this.state.selected_node.type===j?this.state.selected_node.paths[0].has("".concat(t,",").concat(e))&&(this.updateNodePosition(this.state.selected_node.y_pos,this.state.selected_node.x_pos,t,e),n=!0):(this.state.selected_node.paths[0].has("".concat(t,",").concat(e))||this.state.selected_node.paths[1].has("".concat(t,",").concat(e)))&&(this.updateNodePosition(this.state.selected_node.y_pos,this.state.selected_node.x_pos,t,e),n=!0),n&&(this.game_type===w&&this.conn.send({type:y,old_position:"".concat(this.state.selected_node.y_pos,",").concat(this.state.selected_node.x_pos),new_position:"".concat(t,",").concat(e)}),this.setState({selected_node:this.default_selected_node}),this.updateGameRound())}else a.type===this.state.current_turn?this.setState({selected_node:{y_pos:t,x_pos:e,type:a.type,paths:a.paths}}):this.setState({selected_node:this.default_selected_node})}}},{key:"updateGameRound",value:function(){var t=this;this.setState({turn_number:this.state.turn_number+1});var e=!0;this.hound_location.forEach((function(a){var n=a.toString().split(",")[1];t.hare_location.split(",")[1]>n&&(e=!1)})),(this.state.turn_number>20||e)&&(console.log("hare wins!"),this.setState({game_in_progress:!1,winning_side:g}));var a=!0,n=this.hare_location.split(","),s=Object(m.a)(n,2),i=s[0],c=s[1],o=this.state.matrix[i][c].paths;for(var r in o)o[r].forEach((function(e){var n=e.toString().split(","),s=Object(m.a)(n,2),i=s[0],c=s[1];t.state.matrix[i][c].type===O&&(a=!1)}));a&&(console.log("hounds wins!"),this.setState({game_in_progress:!1,winning_side:j}));var d=this.state.current_turn===g?j:g;this.setState({current_turn:d})}},{key:"endGame",value:function(){this.game_type===w?this.conn.close():this.props.EndGameSessionCallback()}},{key:"handleReset",value:function(){this.resetGame(),this.game_type===w&&this.conn.send({type:f})}},{key:"resetGame",value:function(){this.hare_location="",this.hound_location=new Set,this.setState(Object(o.a)(Object(o.a)({},this.state),this.default_state)),this.setGameMatrix(),this.game_type===w&&(console.log(this.state.player_side),this.setState({player_side:this.state.player_side===j?g:j})),this.setState({game_in_progress:!0})}},{key:"getGameNodes",value:function(){var t=[];for(var e in this.state.matrix)for(var a in this.state.matrix[e]){var n=this.state.matrix[e][a],s=!1,i=!1;this.state.selected_node!==this.default_selected_node&&(this.state.selected_node.type===j&&this.state.selected_node.paths[0].has("".concat(e,",").concat(a))&&n.type===O||this.state.selected_node.type===g&&(this.state.selected_node.paths[0].has("".concat(e,",").concat(a))||this.state.selected_node.paths[1].has("".concat(e,",").concat(a)))&&n.type===O)&&(s=!0,i=!0),this.game_type===w&&this.state.current_turn!==this.state.player_side?i=!1:n.type===this.state.current_turn&&(i=!0),this.state.game_in_progress||(i=!1,s=!1),t.push(Object(b.jsx)(v,{x_pos:a,y_pos:e,type:n.type,highlighted:s,onClick:this.selectNode,playable:i},"".concat(e,"-").concat(a)))}return t}},{key:"render",value:function(){var t=this.getGameNodes();return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsxs)("h1",{children:[this.game_type.toUpperCase()," GAME"]}),Object(b.jsxs)("div",{className:"game",children:[Object(b.jsx)("img",{src:"https://www.neok12.com/games/hare-hounds/grid.png",alt:""},"gameboard"),t]}),Object(b.jsxs)("div",{className:"information",children:[""!==this.state.winning_side?Object(b.jsxs)("p",{children:[Object(b.jsx)("b",{children:this.state.winning_side.toUpperCase()})," wins"," "]}):Object(b.jsxs)("p",{children:["Current turn: ",Object(b.jsxs)("b",{children:[this.state.current_turn.toUpperCase(),"S"]})]}),this.game_type===w&&Object(b.jsxs)("p",{children:["You are: ",this.state.player_side]})]}),Object(b.jsxs)("div",{className:"buttons",children:[!this.state.game_in_progress&&Object(b.jsx)("button",{onClick:this.handleReset,children:"Reset Game"}),Object(b.jsx)("button",{onClick:this.endGame,children:"Return Back"})]})]})}}]),a}(n.Component);var S=function(t){var e=t.peer_data,a=t.localGameStart,s=t.attemptConnectionCallback,i=Object(n.useState)(""),c=Object(m.a)(i,2),o=c[0],r=c[1],d=e.err?Object(b.jsx)("p",{children:e.err.toString()}):e.loaded?Object(b.jsxs)("p",{children:["Peer id is: ",e.id]}):Object(b.jsx)("p",{children:"Loading P2P..."});return Object(b.jsxs)("div",{id:"mainmenu",children:[e.connecting?Object(b.jsx)("p",{children:"Connecting..."}):d,Object(b.jsx)("button",{onClick:a,children:"Local Game"}),e.loaded&&!e.err&&Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("input",{onChange:function(t){r(t.target.value)}}),Object(b.jsx)("button",{onClick:function(){return s(o)},children:"Connect"}),Object(b.jsx)("button",{onClick:function(){var t;t="id_in_url"in e?window.location.href.replace(e.id_in_url,e.id):window.location.href+e.id,navigator.clipboard.writeText(t)},children:"Copy link"})]})]})},G=a(3),k="local",w="online",C=function(t){Object(l.a)(a,t);var e=Object(p.a)(a);function a(t){var n;return Object(r.a)(this,a),(n=e.call(this,t)).peer=new u.a,n.conn=null,n.state={peer_data:{err:"",connecting:!1,loaded:!1,id:""},game_data:{active:!1,type:k,online_data:{conn:null,is_host:!1}}},n.localGameStart=n.localGameStart.bind(Object(h.a)(n)),n.onlineGameStart=n.onlineGameStart.bind(Object(h.a)(n)),n.endGameSession=n.endGameSession.bind(Object(h.a)(n)),n.connectToId=n.connectToId.bind(Object(h.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var t=this,e="id"in this.props.match.params;console.log(this.props.match),this.peer.on("error",(function(e){console.log(e),t.setState({peer_data:Object(o.a)(Object(o.a)({},t.state.peer_data),{},{err:e,connecting:!1}),game_data:Object(o.a)(Object(o.a)({},t.state.game_data),{},{active:!1})})})),this.peer.on("open",(function(a){if(t.setState({peer_data:Object(o.a)(Object(o.a)({},t.state.peer_data),{},{loaded:!0,id:a})}),e){var n=t.props.match.params.id;t.connectToId(n),t.setState({peer_data:Object(o.a)(Object(o.a)({},t.state.peer_data),{},{id_in_url:n})})}})),this.peer.on("connection",(function(e){e.on("open",(function(){t.onlineGameStart(e,!0)}))}))}},{key:"endGameSession",value:function(){this.setState({game_data:Object(o.a)(Object(o.a)({},this.state.game_data),{},{active:!1})})}},{key:"connectToId",value:function(t){var e=this;if(""!==t){this.setState({peer_data:Object(o.a)(Object(o.a)({},this.state.peer_data),{},{connecting:!0})});var a=this.peer.connect(t);a.on("open",(function(){e.setState({peer_data:Object(o.a)(Object(o.a)({},e.state.peer_data),{},{connecting:!1})}),e.onlineGameStart(a,!1)}))}}},{key:"localGameStart",value:function(){this.setState({game_data:Object(o.a)(Object(o.a)({},this.state.game_data),{},{type:k,active:!0})})}},{key:"onlineGameStart",value:function(t,e){this.conn=t,this.setState({game_data:Object(o.a)(Object(o.a)({},this.state.game_data),{},{type:w,active:!0,online_data:Object(o.a)(Object(o.a)({},this.state.game_data.online_data),{},{is_host:e})})})}},{key:"render",value:function(){return Object(b.jsxs)("div",{className:"App",children:[Object(b.jsx)("h1",{children:"HARES AND HOUNDS"}),Object(b.jsx)("header",{className:"App-header",children:this.state.game_data.active?Object(b.jsx)(x,{game_data:this.state.game_data,EndGameSessionCallback:this.endGameSession,conn:this.conn}):Object(b.jsx)(S,{peer_data:this.state.peer_data,localGameStart:this.localGameStart,attemptConnectionCallback:this.connectToId})}),Object(b.jsx)("p",{children:Object(b.jsx)("b",{children:"Grid made by NeoK12"})})]})}}]),a}(n.Component),N=Object(G.f)(C),E=a(24);c.a.render(Object(b.jsx)(s.a.StrictMode,{children:Object(b.jsx)(E.a,{basename:"/hares-and-hounds-public",children:Object(b.jsx)(G.c,{children:Object(b.jsx)(G.a,{path:["/","/:id"],exact:!0,component:N})})})}),document.getElementById("root"))}},[[38,1,2]]]);
//# sourceMappingURL=main.cc07aea2.chunk.js.map